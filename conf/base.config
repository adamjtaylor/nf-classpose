/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    nf-classpose base config file
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Default process configuration for all pipelines
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

process {
    // Default resources
    cpus   = 4
    memory = 16.GB
    time   = 4.h

    // Error handling
    errorStrategy = { task.exitStatus in [143,137,104,134,139,140] ? 'retry' : 'finish' }
    maxRetries    = 1
    maxErrors     = '-1'

    // Container
    container = 'ghcr.io/adamjtaylor/nf-classpose:latest'

    // Process-specific resources
    withLabel: process_low {
        cpus   = 2
        memory = 8.GB
        time   = 2.h
    }
    withLabel: process_medium {
        cpus   = 4
        memory = 16.GB
        time   = 4.h
    }
    withLabel: process_high {
        cpus   = 8
        memory = 32.GB
        time   = 8.h
    }
    withLabel: process_gpu {
        cpus   = 4
        memory = 32.GB
        time   = 8.h
    }

    // Vips conversion process uses separate lightweight container
    withName: 'VIPS_CONVERT' {
        container = 'ghcr.io/adamjtaylor/nf-classpose-vips:main'
    }
}
